<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="stylesheet" href="/assets/styles/profile.css">
</head>

<body>

    <%- include('C:/Users/Hp/Desktop/Project/views/homepageNav.ejs') %>

    <div class="profile-container">
        <div class="cover-photo-div" onmouseover="showUpload('cover')" onmouseout="hideUpload('cover')">
            <% if(currentUser.coverPhoto) { %>
            <a href="/profile/coverPhoto">
                <img src="/coverPhoto/<%=currentUser._id%>/<%=currentUser.coverPhoto%>" alt="Cover Photo">
            </a>
            <% } else { %>
            <a href="/profile/coverPhoto">
                <img src="/assets/images/defaultCover/defaultCover.jpg" alt="Default Cover Photo">
            </a>
            <% } %>
            <form id="cover-form" class="upload-form" action="/profile/coverPhoto" method="post"
                enctype="multipart/form-data">
                <input class="file-input" type="file" name="cover-image" onchange="toggleHover('cover')">
                <button class="upload-btn" type="submit">Upload Cover Photo</button>
            </form>
        </div>

        <div class="profile-info">
            <div class="profile-photo-div" onmouseover="showUpload('profile')" onmouseout="hideUpload('profile')">
                <% if(currentUser.profilePhoto) { %>
                <a href="/profile/profilePhoto">
                    <img src="/profilePhoto/<%=currentUser._id%>/<%=currentUser.profilePhoto%>"
                        alt="Profile Photo">
                </a>
                <% } else { %>
                <a href="/profile/profilePhoto">
                    <img src="/assets/images/defaultProfile/defaultProfile.png" alt="Default Profile Photo">
                </a>
                <% } %>
                <form id="profile-form" class="upload-form" action="/profile/profilePhoto" method="post"
                    enctype="multipart/form-data">
                    <input class="file-input" type="file" name="profile-image" onchange="toggleHover('profile')">
                    <button class="upload-btn" type="submit">Upload Profile Photo</button>
                </form>
            </div>
        </div>

        <div class="username-container"
            style="text-align: center; text-transform: uppercase; text-decoration: underline; margin-top: 20px;">
            <h2 class="username"><%= currentUser.username %></h2>
        </div>

        <div class="user-posts">
            <h2>Your Posts</h2>
            <% data.forEach(post => { %>
            <div class="post">
                <p class="post-des"><%= post.postDescription %></p>
                <div class="uploaded-image">
                    <img class="post-image" src="/upload/<%= post.author %>/<%= post.image %>" alt="Post Image">
                </div>
                <div class="interactions">
                    <button class="like-btn">Like</button>
                    <span class="like-count"><%= post.likes %></span>
                    <button class="comment-btn">Comment</button>
                    <span class="comment-count"><%= post.comments %></span>
                    <button class="dislike-btn">Dislike</button>
                    <span class="dislike-count"><%= post.dislikes %></span>
                    <button class="delete-post-btn" data-post-id="<%= post._id %>">Delete Post</button>
                </div>
            </div>
            <% }) %>
        </div>
    </div>

    <script>
        function showUpload(type) {
            const form = document.getElementById(`${type}-form`);
            if (!form.querySelector('.file-input').files.length) {
                form.style.opacity = "1";
            }
        }
    
        function hideUpload(type) {
            const form = document.getElementById(`${type}-form`);
            if (!form.querySelector('.file-input').files.length) {
                form.style.opacity = "0";
                form.reset();
            }
        }
    
        function toggleHover(type) {
            const form = document.getElementById(`${type}-form`);
            const uploadBtn = form.querySelector('.upload-btn');
            const isFileSelected = form.querySelector('.file-input').files.length > 0;
            if (isFileSelected) {
                uploadBtn.classList.add('disabled');
            } else {
                uploadBtn.classList.remove('disabled');
            }
        }
    
        document.querySelectorAll('.delete-post-btn').forEach(button => {
            button.addEventListener('click', async () => {
                const postId = button.getAttribute('data-post-id');
                try {
                    const response = await fetch(`/profile/post/delete/${postId}`, {
                        method: 'GET'
                    });
                    if (response.ok) {
                        location.reload();
                    } else {
                        console.error('Failed to delete post');
                    }
                } catch (error) {
                    console.error('Error:', error);
                }
            });
        });
    </script>
    

</body>

</html>
